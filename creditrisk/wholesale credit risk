风险管理是金融机构的基本职能与核心竞争力，而信用风险无疑是金融机构面临的最重要的一类金融风险. 以银行为代表的传统金融机构源自于信贷，经过了几百年的发展，
到了我们现在这个时代，信用可以说是无所不在。大到国家发行货币与国债，小到我们个人的消费信贷，比如房贷，车贷，信用卡，互联网金融，小贷，微贷，人人贷，花呗，借呗
，我们的金融体系，仍至整个社会经济可以说都是建立在信贷的基础上。而信贷的本质是通过跨时间和空间的资金转移，来达到社会资源的最优配置。当然，达到这种效果的前提是
借贷双方都能做到遵守游戏规则。资金提供方按照条约在规定的时间内提供一定数额的资金借贷方使用，而资金借贷方必须按照条款规定的要求按时还本付息。
如果资金借贷方在到期日无法按照规定支付利息甚至本金，则会造成违约。为了避免由于违约对借出方造成的损失而使得作为借出方金融机构陷人困境，
金融机构必须积极地进行信用风险的管理。比如在放款前对借款方的尽职调查，确保借款方具有足够的还款能力和还款意愿，在放款后对借款方的财务状况和资金使用进
行实时监督，确保资金的用途与贷款的条款规定相一致。同时，通过第三方担保，要求借款方提供资产抵押等方式来降低一旦违约发生所造成的损失。需要说明的是，信用风险是一个
非常广泛的概念。在不同的场合可能具有不同的涵义。无论在国内还是国外，在一般教科书中，对信用风险的描述往往都是基于可交易资产套利定价理论的，而其中最简单的是具有违约风
险的零息债券，在到期日根据债券发行方是否违约，债券投资者获得的支付资金分别为0或1。然后根据债劵的价格和相同到期日的无风险债券的价格，得到在到期日之前的违约概率。此外，
根据CDS的保费费率来计算违约概率也是非常常见的。CDS可以用一个风险债券多头与无风险债券的空头组合来进行复制。对于违约过程的建模，分为结构模型和约化模型。进一步，对于牵涉到多个违约实体的资产定价，
比如CDO, 则除了每个实体的违约风险之外，还需要考虑它们之间违约的相关性，可以用因子模型或者Copula来进行建模。关于这些内容，读者可以参考相关的资料或教科书。我们今天要讲的批发信贷风险，与可交易资产
的信用风险不同。关于批发信用贷款的信用风险管理，由于其自身的特点，尽管在银行的风险管理中占有举足轻重的作用，但这方面的内容在一般的学术文献和教科书中都很少涉及。近几年来由于欧美各国监管部门加强了对
金融机构风险资本评估模型的管理，特别是要求符合条件的金融机构进行年度压力测试，全面评估风险损失，特别是贷款违约风险对于金融机构财务报表和财务状况的影响，以及近两年会计准则对于信贷资产损失计提计算的
新规定，包括IRFS9和CECL, 使得批发信贷风险管理在银行中凸显越来越明显的重要性。这些内容我们在下面的讲解中会逐步展开。批发信贷的风险管理之所以特殊，在于作为其基础资产的贷款，作为借贷双方的协议，
在一般情况下并不是可交易资产。既然如此，也就不存在一个公开的二级市场让我们可以获取其市场公允的价格信息。从而使得我们无法通过传统的资产定价的方法来对批发信贷资产的信用风险进行量化建模。当然这里讲的是一
般的情况。某些情况下，贷款可以在一定条件下在二级市场上进行交易，从而使得我们可以通过某些交易价格信息对信用风险进行量化建模。事实上，银行通过在二级市场上直接出售所持的贷款，或者通过资产证券化打包的方
式将其转化为与债券类似的交易证券售出，从而移出表外，从银行的角度来看是有利的，一方面可以盘活资金，增加资金的利用率从而提高盈利，另一方面由于表内资产的减少，可以降低监管资本的要求。但是由于银行作为风险管
理的核心职能，银行移出表外的资产所占的比重总体而言是非常有限的，事实上，大部分的wholesale loan, 也就是我们讲到的这些工商贷款，商业地产贷款，其二级市场直接出售和通过证券化出售的比例都很低，大部分情况下
银行都是将这些贷款持有到期。银行之所以如此选择，一个是出于维持容户关系的考虑，另一方面由于这些贷款本身的特点，难以形成具有足够流动性一个活跃的二级市场。银行作为专业的风险管理机构，似乎也是最合适自己直接持
有这些资产的。银行的基本业务是吸收存款和发放贷款，通过借贷的形式盘活存量资金，优化配置资源。同时通过存贷款利差赚取利润。存款是银行持有的最主要的债务。贷款是银行持有的最重要的金融资产。银行固然可以通过
资产证券化或者直接在二级市场出售，把一部分贷款转移出资产负债表。但由于作为银行，其本身最重要的核心竞争力之一就是进行风险管理，包括信用风险管理，因此银行持有的贷款依然相当可观。由于一般的工商贷款并非是在金
融市场上公开发行融资的，与股票价格不同，其对外部信息的依赖有一个滞后效应。贷款的信用风险依赖于企业的短期流动性和基本财务状况，企业的财务状况与宏观经济变量往往有滞后的依赖关系。比如，GDP下降或者是失业率上升
，往往在几个月之后才会伴随违约率的上升。原因其实也容易理解，企业在开始面临经营问题，财务吃紧的最初阶段往往最常用的应对措施便是降低运营成本和生产规模，以及裁撤员工，而当企业真正资不抵债走到破产违约这一步之前
，这些能够削减开支和成本的举措都已经使用过了。基于这种原因，我们构建的PD/LGD/EAD的回归方程中，时间t的PD,LGD,EAD往往都依赖于时间t之前的宏观经济变量，当然这里也包括宏观经济变量的某些变换，比如时间増量，滑动窗口平均
，对数时间增量等。银行的基本业务是吸收存款和发放贷款，通过借贷的形式盘活存量资金，优化配置资源。同时通过存贷款利差赚取利润。存款是银行持有的最主要的债务。贷款是银行持有的最重要的金融资产。银行固然可以通过资产证券
化或者直接在二级市场出售，把一部分贷款转移出资产负债表。但由于作为银行，其本身最重要的核心竞争力之一就是进行风险管理，包括信用风险管理，因此银行持有的贷款依然相当可观。描述信用风险损失最普遍的量度是Expected 
Loss, 简称EL. 它的基本形式非常简单，既EAD, PD,LGD的乘积，这三个量分别代表违约的风险暴露，违约概率，违约发生条件下风险暴露所损失的比例。当然，具体的计算并没有那么简单。因为这三个变量并非完全相互独立，存在一
些因素同时影响这三个量。这些因素包括宏观经济变量，以及借贷方的财务状况，经营条件，信用等级，行业，地域，有无担保，抵押等等。在这些变量给定的条件下，比如在压力测试中，场景都是预先给你的，这个时候可以根据条件期望公式计
算出给定场景下的EL. 另一个与之有密切关系，但在财务报告中使用更加普遍的量是所谓的NCO-Net Charge off, 其用来刻画的是公司由于违约风险造成的实际损失对其账面贷款总额进行的实际减值调整。NCO是一个会计上的概念，其
数值不一定等于EL. 比如，从违约发生到违约最终通过市场或其他清算机制被彻底确认有一个时间上的滞后，其长度可以从几个月到几年不等。这个时间段称为LEP-loss emergence period. 违约后的回收率要到贷款最终在帐面上被清
除，称为write-off/Charge-off后才会被最终确定。另一种风险度量称为allowance/减值计提，指的是由于银行对未来可能发生的违约风险的预期而对贷款账面价值预先进行的减值调整。减值计提同样是一个会计的概念。它与NCO的不同在于它
是一个前瞻性的概念，NCO针对的是已经发生违约的贷款。allowance是对未来可能发生的违约的一种预期。其计算除了根据当前的贷款风险和对未来宏观经济的预期估计PD,LGD,EAD计算出EL之外，还包括人为进行的定性调整。批发信用贷款的
风险，取决于几个基本的模型参数。这些参数包括PD,LGD和EAD. 有了这些参数就可以估算EL. 以及与其相关的NCO, allowance这些度量。PD刻画的是违约概率,也就是在一定的期限（通常是一年）内违约发生的可能性。当然这里首先要讨论的是
违约的定义。这个问题可能比大多数人想象的要复杂一些。不同的国家，地区，甚至不同的金融机构和金融产品，违约的定义可能都是不相同的。通常的定义包括企业破产，企业在某些情况下的重组和并购，企业逾期未偿还本金的或利息。这里的
逾期，一般采取的定义是超过偿付期限60，90或120天，分别用60DPD, 90DPD,120DPD表示。对于wholesale loan, 巴塞尔协议推荐的违约逾期为90天。只有明确了违约的定义，才能选取合适的数据进行建模。此外，还要注意排除所谓的技术性违
约。这种违约往往不是由于借贷方缺乏还款能力或意愿而有意为之，而是因为一些技术上的原因，比如支付或清算系统出了问题，导致还款资金没有及时到位等等。一且有了实际违约数据，就可以计算经验违约概率，或者构建违约预测模型。
PD根据是否进行了宏观经济周期调整分为PIT和TTC两类，前者反映了短期的违约风险，其大小与所处的宏观经济周期位置密切相关。而TTC PD则可以看作是一个经济周期内的平均违约概率，或者说是经过调整的违约概率，因此其数值与宏观经济
周期的位置无关。通常根据不同的信用评级分别计算出经验违约概率，并且对数据稀少的高评级段进行平滑调整后的评级/PD的一维列表称为Masterscale, 用于Basel监管资本的计算以及构建PD预测建模的出发点。PD的建模，目标是根据给定的宏
观经济条件和企业的经营特性，构造PD的结构化预测模型。最常见的模型形式是将PD表示为一系列变量的函数，比如logistic函数，对应的模型构造的方法是logistic regression. 这也是wholesale credit 建模最常见的方法，优点是简单，
直观，适用条件宽。模型的参数具有相对直观的涵义。这一点对于监管部门来说非常重要。因为作为监管模型最重要的一点便是可解释性。某些模型，比如深度学习，这方面就差一些。logistic 模型参数估计的基本方法是MLE.将PD模型进一步推广，
我们可以构建一般的评级转移模型。评级的转移可以看成一个离散状态空间下的马尔科夫链，用一个转移矩阵来进行描述。在这个转移矩阵里，状态空间对应所有的可能评级，包括违约，作为一个吸收态。状态之间的转移概率可以构建类似PD的结构
模型进行预测。当然这里需要注意由于概率之和为1，同一行的转移概率不是相互独立的，自由度少一个。而且转移概率也不是常数，而是依赖于宏观经济变量和其他因素的变化。LGD刻画的是违约发生后最终的违约损失占总风险暴露的百分比。LGD在很
大程度上取决于两个变量，也就是seniority 和Collateral. 前者反映的是目标贷款在借贷方所有债务中的优先级，在破产清算中seniority高的债务会被优先偿付给债权人，因此会对应较低的LGD. 另一个变量是collateral, 即抵押品的质量。通常
，高流动性的抵押品，如现金，发达国家的政府债券，贵金属等具有较强的流动性也就是变现能力，因此对应较低的LGD. 而流动性差一些的资产比如房地产作为抵押品则对应的LGD就会高一些。至于无抵押贷款，也就是完全的信用贷款，则对应的LGD最高。
理论上，LGD甚至可以高于100%也就是贷款总额。这种情况发生在高额的催收费用发生时。此外，从违约发生到最终完成债务清算，债务最终从资产负债表上移除，中间需要几个月至几年不等，称为resolution period. 在此期间会有现金流发生交换。
这些现金流构成了回收(Recovery)的主要成分。如果我们对这些现金流进行折现，则所得到的LGD称为economic LGD. 否则称为accounting LGD. 相比于PD, LGD的历史数据更加稀缺。主要是破产清算时日冗长。LGD的建模。与PD相比，LGD同样是一个
0到1之间的数，但它描述的并不是一个概率。因此我们尽管可以用与PD模型形式类似的logistic函数来对其进行建模和拟合，这里我们所进行的不再是logistic regresssion， 而是叫做fractional response regression. 在PD模型中我们的因变量是0/1
的二元事件，即违约是否发生。在LGD模型里我们的因变量是一组0到1之间的实数。我们进行参数估计的方法自然也不再是MLE, 而是类似于最小二乘法的参数拟合法，当然有时文献上会称其为quasi-MLE. FFR曾经是非常主流的LGD建模方法。但是近年来人们意
识到这种方法不适合用来构建LGD的整体模型。原因在于LGD的经验分布特点，使得它看起来并不像是一个连续分布。原因在于相当比例的贷款，其LGD为0或1。这两个点的probability mass是有限的而非无穷小。如果写出LGD的概率分布函数，这两个点应该出现delta函数。
所以更加准确的模型应该考虑到LGD的这一分布特点，一种解决办法是构建一个3阶段模型，分别用来预测LGD为0和1的概率，以及在0到1之间的结构预测方程。FFR显然可以用于这一阶段的建模。但却无法刻画LGD整体的分布特性。目前最流行的LGD建模方法是Tobit模型。
它在本质上考虑到了数据收集时的截尾效应。也就是说，当LGD低于或高于某一阙值的时候，数据采集系统往往会将其记录在这个阙值，而不是真实值。这就是所谓的截尾分布，英文对应的叫做censoring. Tobit 模型考虑了LGD数据的这一特性。此外，决策树也是一种非
常普遍的LGD建模方法。决策树的特点是直观，灵活，可以处理各种复杂的决策边界，缺点是容易过拟合。同时也不太适合具有宏观经济变量这种连续决策因子的情况。EAD是违约发生时的最大损失额度，通常有两种表达惯例，一是总的未偿付贷款的贷币金额，另一
种是前者的百分比率。对于一般的借贷额度和到期期限固定的贷款，也就是term loan, 这个比率是100%。在此情况下我们无须对其进行建模。如果是另一种叫做revolver的情况则有所不同。所谓的revolver类似于信用卡，银行向借贷方提供一个最大额度，借贷方
在一定期限内，可以向银行支取用于其经营目的资金总额的上限。某一时刻借贷方使用的资金额度占这个最大额度的比例为utilization. 不同于term loan, Utilization 在一段时间内可以增加或者减少。也就是说，在有效期内，借贷方可以支取和使用更多的资金，只
要不超过最高额度的上限，也可以选择全部或部分归还之前借出的资金，从而使得utilization 增加。Utilization 的变动值我们记作dU. 因此utilization 不是时间的单调函数。按照这个定义，EAD是违约发生时刻的utilization. 因此对EAD的建模实际上也就是
对utilization或者说对dU的建模。压力测试是金融机构在给定的宏观经济场景，通常是假想的从衰退到恢复的状态路径的条件下，对资产组合与财务报表的盈利与损失，以及资本充足率进行全面预测与评估的过程。目前最有影响力的压力测试是美联储的年
度CCAR压力测试。此外还有欧洲央行ECB在欧盟成员国金融机构中进行的压力测试。压力测试需要资产估值与损益预测模型，但不需要像MC那样的场景生成模型。这些模型必须具备将宏观经济变量与资产
损益相联系的结构形式，即可以根据任意给定的宏观经济场景预测出资产损益的估计值。对于wholesale credit, 一般的过程是构建联系宏观经济变量与信用风险因子，
包括PD,LGD,EAD等之间联系的模型，根据给定场景预测PD,LGD,EAD, 从而进一步预测EL, NCO, Alowance这些信用风险度量。除此之外，还必须构建所谓的Volume模型，也就是贷款总额随宏观经济变量变动的模型。Volume 的变化来自两个方面，一个是已有贷款总额的
变化，比如revolver最大额度的变化，另一个是新放贷款引起的变化。对于新放贷款，我们必须对其特征分布，如地域，评级，行业，企业规模等进行一些假设。这些假设必须符合金融机构的经营战略和放贷政策，因此必须得到业务部门的认可。Volume的建模是一个相
当复杂的过程。通常要将贷款根据不同的特征，如行业，地域，贷款种类等分为不同的segment, 再对不同的segment 根据历史数据构造不同的模型。我们在这里不再进一步展开。此外，还需要根据Volume模型与不同场景下的利率水平，计算盈利水平。Allowance计
算是wholesale credit模型的又一个重要应用。allowance的计算是由会计准则规定的。在美国和其他国家，遵循的分别是GAAP和IAS. 这两类会计准则由于历史的原因，在诸多细节上都有所不同。关于allowance的计算，在过去几十年的时间里，二者分别由FAS5和
IAS39进行规定，共同遵循的原则是所谓的incurred loss approach. 这一原则使得alowance计算时，
所考虑的因素仅限于过去和现在出现的违约或信用状况恶化，而不考虑将来可能发生的信用风险变化。在2014和2016年，IAS与GAAP分别出台了新的allowance计算规则，用于替代原来
的基于incurred loss的旧规则。新的规则分别称为IFRS9 和CECL. 两者的共同点是规定allowance的计算必须考虑将来不同场景下信用风险的可能变化，即所谓的前瞻性-forward looking.这一规定使得allowance的计算在某些方面与压力测试产生了重叠。不同之
处在于场景生成必须包含在allowance计算中，而且生成的场景不止一组，也不能仅仅包括经济衰退的场景。场景可以预先设定，也可以通过量化模型比如ARIMA+GARCH通过MC生成。场景的概率权重则需另行指定。另一个不同点是损失的计算期限。CCAR压力测试的计算期限是9个季度。
\IFRS9下allowance的计算期限则需要视情况而定，取决于资产按照信用风险分类属于哪个阶段。对于信用风险最低的第一阶段，计算期限为1年。对于第二和第三阶段的资产则计算期限需要包含贷款的整个存续期限。因此也称为lifetime loss. 对于CECL, 则规定所有资产均按照
lifetime进行allowance的计算。此外，allowance的计算仅局限于当前的loan portfolio, 因此不需要像压力测试那样考虑Vol
